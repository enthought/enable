<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Undo/Redo Support &mdash; enable 5.0.0 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="_static/css/spc-extend.css">
    <link rel="stylesheet" href="_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" >
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '5.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        LINK_SUFFIX: '',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/js/copybutton.js"></script>
    <script type="text/javascript" src="_static/js/wrap_on_dot.js"></script>
    <link rel="shortcut icon" href="_static/img/favicon.ico">
    <link rel="index" title="Index" href="genindex.html" >
    <link rel="search" title="Search" href="search.html" >
    <link rel="top" title="enable 5.0.0 documentation" href="index.html" >
    <link rel="next" title="Enable Toolkit Selection" href="enable_toolkit_selection.html" >
    <link rel="prev" title="Enable Drag and Drop Events" href="enable_drag_and_drop.html" > 
  </head>
  <body>
  <div class="container">
    <div class="header">
    </div>
  </div>

    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="index.html">enable 5.0.0 documentation</a></li>
	 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
      <li class="active">
        <a href="enable_toolkit_selection.html" title="Enable Toolkit Selection"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="enable_drag_and_drop.html" title="Enable Drag and Drop Events"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body" role="main">
            
  <div class="section" id="undo-redo-support">
<h1>Undo/Redo Support<a class="headerlink" href="#undo-redo-support" title="Permalink to this headline">¶</a></h1>
<p>The <cite>enable.tools.pyface</cite> package has a number of modules that provide
classes for working with Pyface’s Undo/Redo stack.  This permits Enable
tools to add Commands to the Undo/Redo stack, and provides variants of the
MoveTool and ResizeTool that are undoable.</p>
<p>In addition, a tool is provided which binds keystrokes to send undo and
redo requests to the Pyface UndoManager.</p>
<div class="section" id="high-level-tools">
<h2>High-Level Tools<a class="headerlink" href="#high-level-tools" title="Permalink to this headline">¶</a></h2>
<p>There are three tools that provide convenient facilities and reference
implementations of interacting with the undo/redo stack.</p>
<p><code class="docutils literal notranslate"><span class="pre">UndoTool</span></code></p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">UndoTool</span></code> binds keystrokes to undo and redo operations.  The
<code class="docutils literal notranslate"><span class="pre">undo_keys</span></code> and <code class="docutils literal notranslate"><span class="pre">redo_keys</span></code> attributes each take a list of <code class="docutils literal notranslate"><span class="pre">KeySpec</span></code>
objects which should trigger the relevant operations.  The default
values bind undo to ‘Ctrl+Z’ and redo to ‘Ctrl+Shift+Z’.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">UndoTool</span></code> must be provided with an <code class="docutils literal notranslate"><span class="pre">IUndoManager</span></code> that will
actually perform the undo and redo operations.</p>
<p>For example, to bind undo to ‘Ctrl+Left arrow’, and redo to ‘Ctrl+Right
arrow’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">undo_tool</span> <span class="o">=</span> <span class="n">UndoTool</span><span class="p">(</span>
    <span class="n">my_component</span><span class="p">,</span>
    <span class="n">undo_manager</span><span class="o">=</span><span class="n">my_undo_manager</span><span class="p">,</span>
    <span class="n">undo_keys</span><span class="o">=</span><span class="p">[</span><span class="n">KeySpec</span><span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)],</span>
    <span class="n">redo_keys</span><span class="o">=</span><span class="p">[</span><span class="n">KeySpec</span><span class="p">(</span><span class="s1">&#39;Right&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">my_component</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">undo_tool</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MoveCommandTool</span></code></p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">MoveCommandTool</span></code> is a subclass of <code class="docutils literal notranslate"><span class="pre">MoveTool</span></code> that by default
issues a <code class="docutils literal notranslate"><span class="pre">MoveCommand</span></code> at the end of every successful drag move.
A <code class="docutils literal notranslate"><span class="pre">MoveCommand</span></code> stores the new and previous position of the
component so that it can undo and redo the move.  The <code class="docutils literal notranslate"><span class="pre">MoveCommandTool</span></code>
needs to be provided with an <code class="docutils literal notranslate"><span class="pre">ICommandStack</span></code> instance that it will
push commands to, but is otherwise identical to the usual <code class="docutils literal notranslate"><span class="pre">MoveTool</span></code>.</p>
<p>The command tool has a <code class="docutils literal notranslate"><span class="pre">mergeable</span></code> attribute which indicates whether
subsequent move operations with the same component immediately following
this one can be merged into one single move operation.</p>
<p>Typical usage would be something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">move_tool</span> <span class="o">=</span> <span class="n">MoveCommandTool</span><span class="p">(</span><span class="n">my_component</span><span class="p">,</span> <span class="n">command_stack</span><span class="o">=</span><span class="n">my_command_stack</span><span class="p">)</span>
<span class="n">my_component</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">move_tool</span><span class="p">)</span>
</pre></div>
</div>
<p>Users of the tool can provide a different factory to create appropriate
<code class="docutils literal notranslate"><span class="pre">Command</span></code> instances by setting the <code class="docutils literal notranslate"><span class="pre">command</span></code> trait to a callable
that should expect keyword arguments <code class="docutils literal notranslate"><span class="pre">component</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code> (the new
position), <code class="docutils literal notranslate"><span class="pre">previous_position</span></code>, and <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ResizeCommandTool</span></code></p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">ResizeCommandTool</span></code> is a subclass of <code class="docutils literal notranslate"><span class="pre">ResizeTool</span></code> that issues
<code class="docutils literal notranslate"><span class="pre">ResizeCommand</span></code> s at the end of every successful drag move.
A <code class="docutils literal notranslate"><span class="pre">ResizeCommand</span></code> stores the new and previous position and bounds of the
component so that it can undo and redo the resize.  The
<code class="docutils literal notranslate"><span class="pre">ResizeCommandTool</span></code> needs to be provided with an <code class="docutils literal notranslate"><span class="pre">ICommandStack</span></code>
instance that it will push commands to, but is otherwise identical to the
usual <code class="docutils literal notranslate"><span class="pre">ResizeTool</span></code>.</p>
<p>The command tool has a <code class="docutils literal notranslate"><span class="pre">mergeable</span></code> attribute which indicates whether
subsequent resize operations with the same component immediately following
this one can be merged into one single resize operation.</p>
<p>Typical usage would be something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">move_tool</span> <span class="o">=</span> <span class="n">ResizeTool</span><span class="p">(</span><span class="n">my_component</span><span class="p">,</span> <span class="n">command_stack</span><span class="o">=</span><span class="n">my_command_stack</span><span class="p">)</span>
<span class="n">my_component</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">move_tool</span><span class="p">)</span>
</pre></div>
</div>
<p>Users of the tool can provide a different factory to create appropriate
<code class="docutils literal notranslate"><span class="pre">Command</span></code> instances by setting the <code class="docutils literal notranslate"><span class="pre">command</span></code> trait to a callable
that should expect keyword arguments <code class="docutils literal notranslate"><span class="pre">component</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code> (the new
rectangle as a tuple <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">width,</span> <span class="pre">height)</span></code>), <code class="docutils literal notranslate"><span class="pre">previous_rectangle</span></code>,
and <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="command-classes">
<h2>Command Classes<a class="headerlink" href="#command-classes" title="Permalink to this headline">¶</a></h2>
<p>The library provides some useful <code class="docutils literal notranslate"><span class="pre">Command</span></code> subclasses that users may want
to create specialized instances or subclass to customize the behaviour
of their applications.  They may also be of use to <code class="docutils literal notranslate"><span class="pre">CommandAction</span></code> subclasses
outside of the Enable framework (such as menu items or toolbar buttons) which
want to interact with Enable components.</p>
<p><code class="docutils literal notranslate"><span class="pre">ResizeCommand</span></code></p>
<blockquote>
<div><p>This command handles changing the size of a component.  The constructor
expects arguments <code class="docutils literal notranslate"><span class="pre">component</span></code>, <code class="docutils literal notranslate"><span class="pre">new_rectangle</span></code> and (optionally)
<code class="docutils literal notranslate"><span class="pre">previous_rectangle</span></code>, plus optional additional traits.  If
<code class="docutils literal notranslate"><span class="pre">previous_rectangle</span></code> is not provided, then the component’s current
rectangle is used.</p>
<p>Instances hold references to the <code class="docutils literal notranslate"><span class="pre">Component</span></code> being resized in the
<code class="docutils literal notranslate"><span class="pre">component</span></code> attribute, the new and previous rectangles of the component
as tuples <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">width,</span> <span class="pre">height)</span></code> in the <code class="docutils literal notranslate"><span class="pre">data</span></code> and
<code class="docutils literal notranslate"><span class="pre">previous_rectangle</span></code> attributes, and whether or not subsequent resize
operations on the same component should be merged together.</p>
<p>The tool handles the logic of changing the position and bounds of the
component appropriately, as well as invalidating layout and requesting
redraws.</p>
<p>It also provides a default <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">Resize</span> <span class="pre">``</span> <span class="pre">plus</span> <span class="pre">the</span>
<span class="pre">``component_name</span></code> (which in turn defaults to a more human-readable
variant of the component’s class).  Instances can improve this by
either supplying a full replacement for the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute, or
for the <code class="docutils literal notranslate"><span class="pre">component_name</span></code>.</p>
<p>Finally, there is a <code class="docutils literal notranslate"><span class="pre">move_command</span></code> class method that creates a
<code class="docutils literal notranslate"><span class="pre">ResizeCommand</span></code> that just performs a move and is suitable as the
command factory of a <code class="docutils literal notranslate"><span class="pre">MoveCommandTool</span></code>, which allows easy merging
between resize and move operations, if required for the application.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MoveCommand</span></code></p>
<blockquote>
<div><p>This command handles changing the position of a component.  The constructor
expects arguments <code class="docutils literal notranslate"><span class="pre">component</span></code>, <code class="docutils literal notranslate"><span class="pre">previous_position</span></code> and (optionally)
<code class="docutils literal notranslate"><span class="pre">new_position</span></code>, plus optional additional traits.  If <code class="docutils literal notranslate"><span class="pre">new_position</span></code>
is not provided, then the component’s current position is used.</p>
<p>Instances hold references to the <code class="docutils literal notranslate"><span class="pre">Component</span></code> being moved in the
<code class="docutils literal notranslate"><span class="pre">component</span></code> attribute, the new and previous positions of the component as
tuples <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code> in the <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">previous_position</span></code> attributes, and
whether or not subsequent move operations on the same component should
be merged together.</p>
<p>The tool handles the logic of changing the position of the component
appropriately, as well as invalidating layout and requesting
redraws.</p>
<p>It also provides a default <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">Move</span> <span class="pre">``</span> <span class="pre">plus</span> <span class="pre">the</span>
<span class="pre">``component_name</span></code> (which in turn defaults to a more human-readable
variant of the component’s class).  Instances can improve this by
either supplying a full replacement for the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute, or
for the <code class="docutils literal notranslate"><span class="pre">component_name</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="base-classes">
<h2>Base Classes<a class="headerlink" href="#base-classes" title="Permalink to this headline">¶</a></h2>
<p>There are two simple base classes of tools that are potentially of use to
authors of new tools.</p>
<p><code class="docutils literal notranslate"><span class="pre">BaseUndoTool</span></code></p>
<blockquote>
<div><p>Tools which need to be able to trigger undo and redo actions, or otherwise
interact with an undo manager (for example, to set the current command
stack or clear the command history) can inherit from this class.</p>
<p>It has an <code class="docutils literal notranslate"><span class="pre">undo_manager</span></code> attribute which holds a reference to an
<code class="docutils literal notranslate"><span class="pre">IUndoManager</span></code> and provides convenience methods for <code class="docutils literal notranslate"><span class="pre">undo</span></code> and <code class="docutils literal notranslate"><span class="pre">redo</span></code>
using the undo manager.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">BaseCommandTool</span></code></p>
<blockquote>
<div><p>Tools which need to perform undoable actions may want to inherit from this
class.  It provides a standard <code class="docutils literal notranslate"><span class="pre">command_stack</span></code> attribute which
holds a reference to an <code class="docutils literal notranslate"><span class="pre">ICommandStack</span></code>.  It also has a <code class="docutils literal notranslate"><span class="pre">command</span></code>
callable trait that can be overriden by subclasses to create an
appropriate command when demanded by the UI.</p>
</div></blockquote>
<p>In addition to these simple base tools, authors of Tools or Actions that
perform undoable operations on Enable or Chaco components may want to make use
of the following <code class="docutils literal notranslate"><span class="pre">Command</span></code> subclass:</p>
<p><code class="docutils literal notranslate"><span class="pre">ComponentCommand</span></code></p>
<blockquote>
<div><p>This class is an abstract base class for commands which act on Enable
<code class="docutils literal notranslate"><span class="pre">Components</span></code>.  It provides a <code class="docutils literal notranslate"><span class="pre">component</span></code> attribute which holds a
reference to the component that the command should be performed on, and
a <code class="docutils literal notranslate"><span class="pre">component_name</span></code> attribute that can be used to help build the <code class="docutils literal notranslate"><span class="pre">name</span></code>
of the <code class="docutils literal notranslate"><span class="pre">Command</span></code> to be used in textual representations of the command
(eg. in menu item labels).</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">component_name</span></code> is just a more human-friendly version of
the component’s class name, with camel-case converted to words.  Users
are encouraged to override with something even more user-friendly.</p>
</div></blockquote>
</div>
</div>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/img/e-logo.png" alt="Logo">
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Undo/Redo Support</a><ul>
<li><a class="reference internal" href="#high-level-tools">High-Level Tools</a></li>
<li><a class="reference internal" href="#command-classes">Command Classes</a></li>
<li><a class="reference internal" href="#base-classes">Base Classes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="enable_drag_and_drop.html"
                        title="previous chapter">Enable Drag and Drop Events</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="enable_toolkit_selection.html"
                        title="next chapter">Enable Toolkit Selection</a></p>
  <h3>This Page</h3>
  <div>
    <a href="_sources/enable_undo_redo.rst.txt"
       rel="nofollow">Show Source</a>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2005-2021, Enthought
      </li>
      <li>
      Last updated on Feb 23, 2021.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.3.1.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>